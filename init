#!/bin/bash

set -e

if [ $# -ne 1 ]; then
  echo "Usage: $0 <CONTEST_NAME>  (e.g. ABC_439)"
  exit 1
fi

# setting path variables
CONTEST="$1"
BASE_DIR="$(cd "$(dirname "$0")" && pwd)"
SCRIPT_DIR="$BASE_DIR/ABC"
TEMPLATE_DIR="$BASE_DIR/tpl"

CPP_TEMPLATE="$TEMPLATE_DIR/main.cpp.tpl"
MAKEFILE_TEMPLATE="$TEMPLATE_DIR/Makefile.tpl"

if [ ! -f "$CPP_TEMPLATE" ] || [ ! -f "$MAKEFILE_TEMPLATE" ]; then
  echo "Template files missing in $TEMPLATE_DIR"
  exit 1
fi

# create directories
mkdir -p "$SCRIPT_DIR/$CONTEST"
cd "$SCRIPT_DIR/$CONTEST"

mkdir -p test build

# creat files
for p in A B C D E F G; do
  if [ ! -f "$p.cpp" ]; then
    cp "$CPP_TEMPLATE" "$p.cpp"
    echo "Created $p.cpp"
  else
    echo "Skipped $p.cpp"
  fi

  for ext in in out; do
    f="test/$p.$ext"
    if [ ! -f "$f" ]; then
      touch "$f"
      echo "Created $f"
    else
      echo "Skipped $f"
    fi
  done
done

# ensure tab indent
if [ ! -f "Makefile" ]; then
  cp "$MAKEFILE_TEMPLATE" Makefile
  # FIX: convert 4 leading spaces to TABs for make recipes
  sed -i 's/^    /\t/' Makefile
  echo "Created Makefile (tabs normalized)"
else
  echo "Skipped Makefile"
fi

echo "Contest $CONTEST setup complete (template-based, no overwrites)."

